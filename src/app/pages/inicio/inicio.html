<div class="dashboard-layout">
  <!-- Shared Sidebar with role-based menu -->
  <app-sidebar [activeMenu]="'dashboard'"></app-sidebar>

  <!-- Main Content -->
  <main class="main-content">
    <!-- Top Header -->
    <header class="top-header">
      <div class="header-left">
        <h1>{{ getGreeting() }}, <span class="user-name">{{ getFirstName() }}</span></h1>
        <p class="header-subtitle">Panel de control del sistema de evaluación psicológica</p>
      </div>
      <div class="header-right">
        <div class="user-badge">
          <div class="avatar">
            {{ currentUser()?.nombreCompleto?.charAt(0)?.toUpperCase() || 'U' }}
          </div>
          <div class="user-info">
            <span class="user-role">{{ currentUser()?.especialidad || 'Profesional' }}</span>
          </div>
        </div>
      </div>
    </header>

    <!-- Stats Cards -->
    <section class="stats-grid animate-fadeIn">
      <!-- Skeleton Stats -->
      <ng-container *ngIf="loading(); else statsContent">
        <div class="skeleton-stat-card" *ngFor="let i of [1,2,3,4]">
          <div class="skeleton skeleton-stat-icon"></div>
          <div class="skeleton-stat-content">
            <div class="skeleton skeleton-text-lg" style="width: 60%;"></div>
            <div class="skeleton skeleton-text-sm" style="width: 80%;"></div>
          </div>
        </div>
      </ng-container>

      <ng-template #statsContent>
        <div class="stat-card">
          <div class="stat-icon patients">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2" />
              <circle cx="9" cy="7" r="4" />
              <path d="M23 21v-2a4 4 0 0 0-3-3.87" />
              <path d="M16 3.13a4 4 0 0 1 0 7.75" />
            </svg>
          </div>
          <div class="stat-content">
            <span class="stat-value">{{ totalPacientes() }}</span>
            <span class="stat-label">Pacientes registrados</span>
          </div>
        </div>

        <div class="stat-card">
          <div class="stat-icon today">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="3" y="4" width="18" height="18" rx="2" ry="2" />
              <line x1="16" y1="2" x2="16" y2="6" />
              <line x1="8" y1="2" x2="8" y2="6" />
              <line x1="3" y1="10" x2="21" y2="10" />
            </svg>
          </div>
          <div class="stat-content">
            <span class="stat-value">{{ evaluacionesHoy() }}</span>
            <span class="stat-label">Evaluaciones hoy</span>
          </div>
        </div>

        <div class="stat-card">
          <div class="stat-icon week">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="18" y1="20" x2="18" y2="10" />
              <line x1="12" y1="20" x2="12" y2="4" />
              <line x1="6" y1="20" x2="6" y2="14" />
            </svg>
          </div>
          <div class="stat-content">
            <span class="stat-value">{{ evaluacionesSemana() }}</span>
            <span class="stat-label">Esta semana</span>
          </div>
        </div>

        <div class="stat-card">
          <div class="stat-icon total">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" />
              <polyline points="14 2 14 8 20 8" />
              <line x1="16" y1="13" x2="8" y2="13" />
              <line x1="16" y1="17" x2="8" y2="17" />
            </svg>
          </div>
          <div class="stat-content">
            <span class="stat-value">{{ evaluaciones().length }}</span>
            <span class="stat-label">Total evaluaciones</span>
          </div>
        </div>
      </ng-template>
    </section>

    <!-- Content Grid -->
    <section class="content-grid">
      <!-- Recent Evaluations -->
      <div class="content-card evaluations-card animate-fadeIn" style="animation-delay: 0.1s;">
        <div class="card-header">
          <h2>Evaluaciones recientes</h2>
          <a routerLink="/evaluaciones" class="view-all">Ver todas →</a>
        </div>

        <!-- Skeleton Table -->
        <div *ngIf="loading(); else tableContent">
          <div class="skeleton-table-row" *ngFor="let i of [1,2,3,4,5]">
            <div class="skeleton skeleton-table-cell" style="max-width: 100px;"></div>
            <div class="skeleton skeleton-table-cell" style="max-width: 80px;"></div>
            <div class="skeleton skeleton-table-cell" style="max-width: 60px;"></div>
            <div class="skeleton skeleton-table-cell" style="max-width: 60px;"></div>
            <div class="skeleton skeleton-table-cell" style="max-width: 60px;"></div>
          </div>
        </div>

        <ng-template #tableContent>
          <div class="table-wrapper" *ngIf="evaluaciones().length > 0; else noEvaluaciones">
            <table class="data-table">
              <thead>
                <tr>
                  <th>Fecha</th>
                  <th>Estado</th>
                  <th>Ansiedad</th>
                  <th>Depresión</th>
                  <th>Estrés</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let ev of evaluaciones().slice(0, 5)">
                  <td>{{ formatDate(ev.fechaHora) }}</td>
                  <td>
                    <span class="status-badge" [class.completed]="ev.estado === 'COMPLETADA'">
                      {{ ev.estado || 'Pendiente' }}
                    </span>
                  </td>
                  <td>
                    <span class="level-badge" [ngClass]="getNivelClass(ev.nivelAnsiedad)">
                      {{ ev.nivelAnsiedad || '-' }}
                    </span>
                  </td>
                  <td>
                    <span class="level-badge" [ngClass]="getNivelClass(ev.nivelDepresion)">
                      {{ ev.nivelDepresion || '-' }}
                    </span>
                  </td>
                  <td>
                    <span class="level-badge" [ngClass]="getNivelClass(ev.nivelEstres)">
                      {{ ev.nivelEstres || '-' }}
                    </span>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>

          <ng-template #noEvaluaciones>
            <div class="empty-state">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" />
                <polyline points="14 2 14 8 20 8" />
              </svg>
              <p>No hay evaluaciones registradas</p>
              <a routerLink="/evaluaciones" class="btn-primary-sm">Nueva evaluación</a>
            </div>
          </ng-template>
        </ng-template>
      </div>

      <!-- Quick Actions -->
      <div class="content-card quick-actions-card animate-fadeIn" style="animation-delay: 0.2s;">
        <div class="card-header">
          <h2>Acciones rápidas</h2>
        </div>

        <div class="actions-list">
          <a routerLink="/pacientes" class="action-item">
            <div class="action-icon new-patient">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2" />
                <circle cx="8.5" cy="7" r="4" />
                <line x1="20" y1="8" x2="20" y2="14" />
                <line x1="23" y1="11" x2="17" y2="11" />
              </svg>
            </div>
            <div class="action-content">
              <span class="action-title">Nuevo paciente</span>
              <span class="action-desc">Registrar un nuevo paciente</span>
            </div>
          </a>

          <a routerLink="/evaluaciones" class="action-item">
            <div class="action-icon new-eval">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" />
                <polyline points="14 2 14 8 20 8" />
                <line x1="12" y1="18" x2="12" y2="12" />
                <line x1="9" y1="15" x2="15" y2="15" />
              </svg>
            </div>
            <div class="action-content">
              <span class="action-title">Nueva evaluación</span>
              <span class="action-desc">Iniciar evaluación psicológica</span>
            </div>
          </a>

          <a routerLink="/pacientes" class="action-item">
            <div class="action-icon view-patients">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="11" cy="11" r="8" />
                <line x1="21" y1="21" x2="16.65" y2="16.65" />
              </svg>
            </div>
            <div class="action-content">
              <span class="action-title">Buscar paciente</span>
              <span class="action-desc">Ver lista de pacientes</span>
            </div>
          </a>
        </div>
      </div>
    </section>
  </main>
</div>